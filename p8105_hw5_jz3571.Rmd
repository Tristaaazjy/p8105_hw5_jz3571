---
title: "p8105_hw5_jz3571"
author: "Junyan Zhu"
date: "2022-11-14"
output: github_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message=FALSE}
library(tidyverse)
library(patchwork)
```

## Problem 1

```{r, message=FALSE}
longstudy_df = 
  tibble(file_name = list.files(path =  "./data/P1") ) %>% 
  mutate(
    path = str_c("./data/P1/", file_name),
    data = map(.x = path, ~read_csv(.x))
  ) %>% 
  separate(file_name, into = c("arm", "id"), sep = "_") %>% 
  mutate(id = gsub(".csv", "", id),
         arm = recode(arm, con = "control", exp = 'experiment')) %>% 
  select(-path) %>% 
  unnest(data) %>% 
  pivot_longer(week_1: week_8,
               names_to = "week",
               values_to = "observation",
               names_prefix = "week_")
```

```{r}
longstudy_df 
```

```{r}
control_plot = longstudy_df %>% 
  filter(arm == "control") %>% 
  mutate(week = as.numeric(week))%>% 
  ggplot(aes(x = week, y = observation, group = id)) +
  geom_line(aes(color = id)) +
  labs(title = "Observations of Control by Week",
       x = "Time (week)",
       y = "Obervation'") +
  theme(legend.position = "bottom")

experiment_plot = longstudy_df %>% 
  filter(arm == "experiment") %>% 
  mutate(week = as.numeric(week))%>% 
  ggplot(aes(x = week, y = observation, group = id)) +
  geom_line(aes(color = id)) +
  labs(title = "Observations of Experiment by Week",
       x = "Time (week)",
       y = "Obervation'") +
  theme(legend.position = "bottom")

control_plot + experiment_plot
```

The experiment arm has a higher observation data compared to control arm. The control and experiment arms had similar observations for the first several weeks. However, as time goes, the experiment arms have a increasing trend while the control arms have a fluctuation trend.


## Problem 2

```{r}
homicide_df = read_csv("./data/homicide-data.csv")
```

The raw data from Washington Post homicide data has 52179 rows and 12 columns. It recorded 52179 homicide cases with 12 variables, including uid, reported date, victim's last name, victim's first name, victim's race, age, sex, city, state, the location of the killing in latitude and longitude and also disposition.

```{r}
homicide_df %>% 
  mutate(city_state = str_c(city, state, sep = "_")) %>% 
  group_by(city_state) %>% 
  summarise(total = n(), unresolved = sum(disposition == "Closed without arrest" | disposition == "Open/No arrest")) 

```

